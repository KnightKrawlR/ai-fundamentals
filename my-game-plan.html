<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Game Plan | AI Fundamentals</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/game-styles.css">
    <link rel="stylesheet" href="css/header-redesign.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Add Tailwind CSS for the React app -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                200: '#bae6fd',
                300: '#7dd3fc',
                400: '#38bdf8',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
                800: '#075985',
                900: '#0c4a6e',
              },
            },
          },
        },
      }
    </script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>

    <style>
      /* Override styles for React components */
      #game-plan-root {
        min-height: 500px;
        padding: 20px 0;
      }
      
      /* Fix for primary color classes */
      .bg-primary-500 {
        background-color: #0ea5e9;
      }
      .bg-primary-600 {
        background-color: #0284c7;
      }
      .bg-primary-700 {
        background-color: #0369a1;
      }
      .text-primary-600 {
        color: #0284c7;
      }
      .border-primary-500 {
        border-color: #0ea5e9;
      }
      .bg-primary-100 {
        background-color: #e0f2fe;
      }
      .bg-primary-50 {
        background-color: #f0f9ff;
      }
      
      /* Basic utility classes that might be missing */
      .flex { display: flex; }
      .flex-1 { flex: 1; }
      .flex-col { flex-direction: column; }
      .items-center { align-items: center; }
      .justify-center { justify-content: center; }
      .space-y-4 > * + * { margin-top: 1rem; }
      .min-h-\[500px\] { min-height: 500px; }
      .rounded-lg { border-radius: 0.5rem; }
      .rounded-md { border-radius: 0.375rem; }
      .rounded { border-radius: 0.25rem; }
      .p-4 { padding: 1rem; }
      .border { border-width: 1px; }

      /* User menu styles */
      .user-menu {
          position: relative;
          display: inline-block;
      }

      .user-menu-content {
          display: none;
          position: absolute;
          right: 0;
          background-color: white;
          min-width: 200px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          border-radius: 4px;
          padding: 8px 0;
          z-index: 1000;
      }

      .user-menu:hover .user-menu-content {
          display: block;
      }

      .user-menu-item {
          display: block;
          padding: 8px 16px;
          color: #333;
          text-decoration: none;
          transition: background-color 0.3s;
      }

      .user-menu-item:hover {
          background-color: #f5f5f5;
      }

      .user-menu-divider {
          height: 1px;
          background-color: #eee;
          margin: 8px 0;
      }

      .user-profile-btn {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 8px 16px;
          border: none;
          background: none;
          cursor: pointer;
          color: white;
      }

      .user-avatar {
          width: 32px;
          height: 32px;
          border-radius: 50%;
          background-color: #6c5ce7;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: 500;
      }

      .sign-in-btn {
          display: flex;
          align-items: center;
          gap: 8px;
          color: white;
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1rem;
          text-decoration: none;
      }

      .sign-in-btn i {
          font-size: 20px;
      }
      
      /* Game Plan Form Styles */
      .game-plan-form {
        max-width: 800px;
        margin: 0 auto;
        padding: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .form-group {
        margin-bottom: 1.5rem;
      }
      
      .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #333;
      }
      
      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }
      
      .form-textarea {
        min-height: 120px;
        resize: vertical;
      }
      
      .form-submit {
        background-color: #0ea5e9;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      
      .form-submit:hover {
        background-color: #0284c7;
      }
      
      /* Game Plan Result Styles */
      .game-plan-result {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .result-section {
        margin-bottom: 2rem;
      }
      
      .result-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: #333;
        border-bottom: 2px solid #e0f2fe;
        padding-bottom: 0.5rem;
      }
      
      .step-list {
        list-style-type: none;
        padding: 0;
      }
      
      .step-item {
        padding: 0.75rem;
        border-left: 3px solid #0ea5e9;
        background-color: #f0f9ff;
        margin-bottom: 0.75rem;
      }
      
      .tech-card {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .tech-title {
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      
      .resource-link {
        display: block;
        padding: 0.75rem;
        background-color: #f0f9ff;
        border-radius: 4px;
        margin-bottom: 0.5rem;
        text-decoration: none;
        color: #0284c7;
        transition: background-color 0.3s;
      }
      
      .resource-link:hover {
        background-color: #e0f2fe;
      }
      
      .resource-type {
        font-size: 0.8rem;
        color: #666;
        margin-left: 0.5rem;
      }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">
                <i class="fas fa-brain"></i>
                <h1>AI Fundamentals</h1>
            </a>
            <nav>
                <ul>
                    <li><a href="index.html">Learning</a></li>
                    <li><a href="ai-tools.html">AI Tools</a></li>
                    <li><a href="premium.html">Premium</a></li>
                </ul>
            </nav>
            <div id="auth-container">
                <a href="login.html" class="sign-in-btn" id="sign-in-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Sign In</span>
                </a>
                <div class="user-menu" id="user-menu" style="display: none;">
                    <button class="user-profile-btn">
                        <div class="user-avatar" id="user-avatar"></div>
                        <span id="user-email"></span>
                    </button>
                    <div class="user-menu-content">
                        <a href="account.html" class="user-menu-item">
                            <i class="fas fa-user"></i> My Account
                        </a>
                        <a href="my-learning.html" class="user-menu-item">
                            <i class="fas fa-graduation-cap"></i> My Learning
                        </a>
                        <a href="my-games.html" class="user-menu-item premium-item">
                            <i class="fas fa-gamepad"></i> My Games
                        </a>
                        <a href="my-game-plan.html" class="user-menu-item premium-item">
                            <i class="fas fa-clipboard-list"></i> My Game Plan
                        </a>
                        <a href="settings.html" class="user-menu-item">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <div class="user-menu-divider"></div>
                        <a href="#" class="user-menu-item" id="sign-out-btn">
                            <i class="fas fa-sign-out-alt"></i> Sign Out
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <div class="page-header">
                <h1>My Game Plan</h1>
                <p>Generate personalized AI project implementation plans to guide your learning journey</p>
            </div>
            
            <div id="game-plan-root">
                <!-- Game Plan Generator Form -->
                <div class="game-plan-form">
                    <h2>Create Your Project Plan</h2>
                    <p>Describe your project or select a category to get a detailed implementation plan</p>
                    
                    <form id="game-plan-form">
                        <div class="form-group">
                            <label for="category" class="form-label">Project Category</label>
                            <select id="category" class="form-select">
                                <option value="">Select a category</option>
                                <option value="Web Application">Web Application</option>
                                <option value="Mobile App">Mobile App</option>
                                <option value="Data Analysis">Data Analysis</option>
                                <option value="Machine Learning">Machine Learning</option>
                                <option value="Game Development">Game Development</option>
                                <option value="IoT Project">IoT Project</option>
                                <option value="Automation">Automation</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="topic" class="form-label">Project Topic (Optional)</label>
                            <input type="text" id="topic" class="form-input" placeholder="E.g. E-commerce, Portfolio, Recipe Manager">
                        </div>
                        
                        <div class="form-group">
                            <label for="description" class="form-label">Project Description</label>
                            <textarea id="description" class="form-textarea" placeholder="Describe your project in detail. What are you trying to build? What problem does it solve?"></textarea>
                        </div>
                        
                        <button type="button" id="generate-btn" class="form-submit">
                            <i class="fas fa-magic"></i> Generate Game Plan
                        </button>
                    </form>
                </div>
                
                <!-- Game Plan Result (Initially Hidden) -->
                <div id="game-plan-result" class="game-plan-result" style="display: none;">
                    <div id="loading-indicator" style="text-align: center; display: none;">
                        <div class="spinner" style="border: 4px solid rgba(0,0,0,.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #5D3FD3; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                        <p style="margin-top: 16px;">Generating your game plan...</p>
                    </div>
                    
                    <div id="result-content">
                        <div class="result-section">
                            <h2 class="result-title"><i class="fas fa-list-ul"></i> Implementation Steps</h2>
                            <ul id="step-list" class="step-list">
                                <!-- Steps will be dynamically added here -->
                            </ul>
                        </div>
                        
                        <div class="result-section">
                            <h2 class="result-title"><i class="fas fa-tools"></i> Recommended Technologies</h2>
                            <div id="tech-list">
                                <!-- Tech cards will be dynamically added here -->
                            </div>
                        </div>
                        
                        <div class="result-section">
                            <h2 class="result-title"><i class="fas fa-book"></i> Learning Resources</h2>
                            <div id="resource-list">
                                <!-- Resource links will be dynamically added here -->
                            </div>
                        </div>
                        
                        <button id="new-plan-btn" class="form-submit">
                            <i class="fas fa-plus"></i> Create New Plan
                        </button>
                    </div>
                </div>
                
                <!-- Fallback if JavaScript fails to load -->
                <div id="loading-fallback" style="display: none;">
                    <div style="text-align: center;">
                        <div class="spinner" style="border: 4px solid rgba(0,0,0,.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: #5D3FD3; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                        <p style="margin-top: 16px;">Loading Game Plan generator...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AI Fundamentals</h3>
                    <p>Your journey to AI mastery starts here</p>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Flashcards</a></li>
                        <li><a href="#">Study Guides</a></li>
                        <li><a href="#">Video Lessons</a></li>
                        <li><a href="#">Practice Quizzes</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Company</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Cookie Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 AI Fundamentals. All rights reserved.</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>

    <!-- Auth Integration -->
    <script src="js/auth-integration.js"></script>
    <script src="js/stripe-integration.js"></script>
    <script src="js/access-control.js"></script>

    <!-- Firebase Configuration -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDjMisQkMgdA6qNg7gnXDumhNOOWOD-Y00",
            authDomain: "ai-fundamentals-ad37d.firebaseapp.com",
            projectId: "ai-fundamentals-ad37d",
            storageBucket: "ai-fundamentals-ad37d.appspot.com",
            messagingSenderId: "668115447112",
            appId: "1:668115447112:web:c0772e9f8c6a498737977d",
            measurementId: "G-2D5V39EQ3T"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Auth state observer
        firebase.auth().onAuthStateChanged((user) => {
            const signInBtn = document.getElementById('sign-in-btn');
            const userMenu = document.getElementById('user-menu');
            const userAvatar = document.getElementById('user-avatar');
            const userEmail = document.getElementById('user-email');
            
            if (user) {
                // User is signed in
                signInBtn.style.display = 'none';
                userMenu.style.display = 'block';
                
                // Set user email and avatar
                userEmail.textContent = user.email;
                userAvatar.textContent = user.email[0].toUpperCase();
                
                // Update premium content visibility
                document.querySelectorAll('.premium-content').forEach(elem => {
                    elem.classList.add('unlocked');
                });
            } else {
                // User is signed out
                signInBtn.style.display = 'flex';
                userMenu.style.display = 'none';
                
                // Update premium content visibility
                document.querySelectorAll('.premium-content').forEach(elem => {
                    elem.classList.remove('unlocked');
                });
                
                // Redirect to login page since this is a premium feature
                window.location.href = 'login.html?redirect=my-game-plan.html';
            }
        });

        // Sign out functionality
        document.getElementById('sign-out-btn').addEventListener('click', (e) => {
            e.preventDefault();
            firebase.auth().signOut().then(() => {
                window.location.href = 'index.html';
            }).catch((error) => {
                console.error('Sign out error:', error);
            });
        });
    </script>

    <!-- Game Plan functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const generateBtn = document.getElementById('generate-btn');
            const newPlanBtn = document.getElementById('new-plan-btn');
            const formElement = document.querySelector('.game-plan-form');
            const resultElement = document.getElementById('game-plan-result');
            const loadingIndicator = document.getElementById('loading-indicator');
            const stepList = document.getElementById('step-list');
            const techList = document.getElementById('tech-list');
            const resourceList = document.getElementById('resource-list');
            
            // Event listeners
            generateBtn.addEventListener('click', generateGamePlan);
            newPlanBtn.addEventListener('click', showForm);
            
            // Show the form initially
            showForm();
            
            // Function to show the form and hide results
            function showForm() {
                formElement.style.display = 'block';
                resultElement.style.display = 'none';
            }
            
            // Function to show results and hide form
            function showResults() {
                formElement.style.display = 'none';
                resultElement.style.display = 'block';
                loadingIndicator.style.display = 'none';
            }
            
            // Get function base URL for HTTP endpoints
            const functionBaseUrl = 'https://us-central1-ai-fundamentals-ad37d.cloudfunctions.net';
            
            // Function to generate game plan
            function generateGamePlan() {
                // Get form values
                const category = document.getElementById('category').value;
                const topic = document.getElementById('topic').value;
                const description = document.getElementById('description').value;
                
                // Validate form
                if (!category && !description) {
                    alert('Please select a category or provide a project description');
                    return;
                }
                
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                resultElement.style.display = 'block';
                formElement.style.display = 'none';
                
                // Prepare request data
                const requestData = {
                    category: category,
                    topic: topic,
                    projectDescription: description,
                    model: 'grok-2-instruct'
                };
                
                // Try the callable function first
                tryCallableFunction(requestData)
                    .catch(error => {
                        console.warn('Callable function failed, trying HTTP endpoint:', error);
                        return tryHttpFunction(requestData);
                    })
                    .then(displayResults)
                    .catch(handleError);
            }
            
            // Function to try the callable function
            function tryCallableFunction(data) {
                const functions = firebase.functions();
                const generateGamePlanFunction = functions.httpsCallable('generateGamePlan');
                
                return generateGamePlanFunction(data)
                    .then(result => {
                        // Check if the result is successful
                        if (!result.data.success) {
                            throw new Error(result.data.message || 'Unknown error');
                        }
                        
                        return result.data;
                    });
            }
            
            // Function to try the HTTP function as fallback
            function tryHttpFunction(data) {
                return fetch(`${functionBaseUrl}/generateGamePlanHttp`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data.success) {
                        throw new Error(data.error || 'Unknown error');
                    }
                    
                    return data;
                });
            }
            
            // Function to display the results
            function displayResults(data) {
                // Display implementation steps
                stepList.innerHTML = '';
                data.plan.forEach(step => {
                    const li = document.createElement('li');
                    li.className = 'step-item';
                    li.textContent = step;
                    stepList.appendChild(li);
                });
                
                // Display technologies
                techList.innerHTML = '';
                data.technologies.forEach(tech => {
                    const techCard = document.createElement('div');
                    techCard.className = 'tech-card';
                    
                    const techTitle = document.createElement('div');
                    techTitle.className = 'tech-title';
                    techTitle.textContent = tech.name;
                    
                    const techDesc = document.createElement('div');
                    techDesc.className = 'tech-desc';
                    techDesc.textContent = tech.description;
                    
                    techCard.appendChild(techTitle);
                    techCard.appendChild(techDesc);
                    techList.appendChild(techCard);
                });
                
                // Display resources
                resourceList.innerHTML = '';
                data.resources.forEach(resource => {
                    const resourceLink = document.createElement('a');
                    resourceLink.className = 'resource-link';
                    resourceLink.href = resource.url;
                    resourceLink.target = '_blank';
                    resourceLink.rel = 'noopener noreferrer';
                    
                    resourceLink.textContent = resource.title;
                    
                    const resourceType = document.createElement('span');
                    resourceType.className = 'resource-type';
                    resourceType.textContent = resource.type || 'Resource';
                    
                    resourceLink.appendChild(resourceType);
                    resourceList.appendChild(resourceLink);
                });
                
                // Show results
                showResults();
            }
            
            // Function to handle errors
            function handleError(error) {
                console.error('Error generating game plan:', error);
                alert('Error generating game plan: ' + error.message);
                showForm();
            }
        });
    </script>
</body>
</html>
